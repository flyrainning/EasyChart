"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function EC_UUID(t,i){var e,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(i=i||o.length,t)for(e=0;e<t;e++)a[e]=o[0|Math.random()*i];else{var n;for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",e=0;e<36;e++)a[e]||(n=0|16*Math.random(),a[e]=o[19==e?3&n|8:n])}return a.join("")}function EC_ID(t){return(t=t||"ID")+"_"+EC_UUID(10)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(i,e,o){return e&&t(i.prototype,e),o&&t(i,o),i}}(),EC_Group=function(){function t(){_classCallCheck(this,t),this.count=0,this.item=[]}return _createClass(t,[{key:"addItem",value:function(t){this.item.push(t),this.count=this.item.length}},{key:"add",value:function(t){var i=new EasyChart(t);return this.addItem(i),i}},{key:"get",value:function(t){return this.getByID(t)}},{key:"getByID",value:function(t){var i;return this.item.forEach(function(e,o){e.opt.id==t&&(i=e)}),i}},{key:"getByIndex",value:function(t){return this.item[t]}}]),t}();window&&!window.EC&&(window.EC=new EC_Group);var EasyChart=function(){function t(i){_classCallCheck(this,t),this.opt={echarts_style:"macarons",loading_text:"加载中 ...",uri:"/EasyChart/api",post:!1,width:"",height:"",use_websocket:!1},this.echarts=!1,this.is_debug=!1,this.EL=!1,this.init(i)}return _createClass(t,[{key:"debug",value:function(t){this.is_debug=!!t}},{key:"setOpt",value:function(t){t=t||{},this.opt=Object.assign(this.opt,t)}},{key:"init",value:function(t){this.setOpt(t),this.echarts||(this.opt.id?(this.EL=jQuery("#"+this.opt.id),this.opt.width&&this.EL.css({width:this.opt.width}),this.opt.height&&this.EL.css({height:this.opt.height}),this.echarts=echarts.init(document.getElementById(this.opt.id),this.opt.echarts_style),this.echarts.showLoading({text:this.opt.loading_text}),"function"==typeof this.opt.onload&&this.opt.onload(this)):this.is_debug&&console.log("No id found for EasyChart"))}},{key:"send",value:function(t,i){this.opt.use_websocket||this.ajax(this.opt.api,t,i)}},{key:"ajax",value:function(t,i,e){var o=this;jQuery.ajax({type:"POST",timeout:6e5,url:this.opt.uri+"/index.php?api="+t,data:i,success:e,error:function(t,i,e){o.msg("与服务器链接失败，请重试 : "+i+"  "+e,!0)}})}},{key:"msg",value:function(t){t?this.echarts.showLoading({text:t}):this.echarts.hideLoading()}},{key:"load",value:function(t,i){this.echarts?i&&this.init(i):this.init(i);var e=this,o=t||this.opt.post||"";"object"!=(void 0===o?"undefined":_typeof(o))&&(o={data:o}),this.send(o,function(i){i.result?(e.is_debug&&(console.log("config:",config),console.log("data:",t),console.log("option:",opt)),e.echarts.setOption(opt)):e.msg(i.data),e.echarts.hideLoading()})}}]),t}();jQuery(function(t){t("[EasyChart]").each(function(i){var e={},o=t(this).data("opt");o&&(e="object"==(void 0===o?"undefined":_typeof(o))?o:JSON.parse(o));var a=t(this).attr("id");a||(a=e.id||EC_ID("EasyChart"),t(this).attr("id",a)),e.id=a;var n=t(this).data("api");n&&(e.api=n),t(this).data("debug")&&(e.debug=!0,u.debug(!0));var s=t(this).data("onload");s&&"function"==typeof window[s]&&(e.onload=window[s]),window.EasyChart_delaytime=1;var h=parseInt(t(this).data("delay"));h||(e.delay?h=e.delay:(h=window.EasyChart_delaytime,window.EasyChart_delaytime+=300));var r=t(this).data("post");r&&(e.post="object"==(void 0===r?"undefined":_typeof(r))?r:JSON.parse(r));var u=window.EC.add(e);t(this).data("EasyChart",u),window.setTimeout(function(){u.load()},h)})});