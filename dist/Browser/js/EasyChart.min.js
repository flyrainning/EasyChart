"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function EC_UUID(t,e){var i,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(e=e||o.length,t)for(i=0;i<t;i++)a[i]=o[0|Math.random()*e];else{var n;for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",i=0;i<36;i++)a[i]||(n=0|16*Math.random(),a[i]=o[19==i?3&n|8:n])}return a.join("")}function EC_ID(t){return(t=t||"ID")+"_"+EC_UUID(10)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),EC_Group=function(){function t(){_classCallCheck(this,t),this.count=0,this.item=[];var e=this;window.addEventListener("resize",function(){e.resize()})}return _createClass(t,[{key:"addItem",value:function(t){this.item.push(t),this.count=this.item.length}},{key:"add",value:function(t){var e=new EasyChart(t);return this.addItem(e),e}},{key:"get",value:function(t){return this.getByID(t)}},{key:"getByID",value:function(t){var e;return this.item.forEach(function(i,o){i.opt.id==t&&(e=i)}),e}},{key:"getByIndex",value:function(t){return this.item[t]}},{key:"resize",value:function(){this.item.forEach(function(t,e){t.resize()})}}]),t}();window&&!window.EC&&(window.EC=new EC_Group);var EasyChart=function(){function t(e){_classCallCheck(this,t);var i={};"object"==("undefined"==typeof EasyChart_config?"undefined":_typeof(EasyChart_config))&&(i=EasyChart_config),this.opt=Object.assign({id:"",echarts_style:"macarons",loading_text:"loading ...",uri:"/api/",post:!1,width:"",height:"",debug:!1,use_websocket:!1},i),this.echarts=!1,this.DOM=!1,this.init(e)}return _createClass(t,[{key:"debug",value:function(t){this.opt.debug=!!t}},{key:"setOpt",value:function(t){t=t||{},this.opt=Object.assign(this.opt,t)}},{key:"init",value:function(t){this.setOpt(t),this.log("init option:",t),this.echarts||(this.opt.id?(this.DOM=jQuery("#"+this.opt.id),this.DOM.html(""),this.size(),this.echarts=echarts.init(document.getElementById(this.opt.id),this.opt.echarts_style),this.echarts.showLoading({text:this.opt.loading_text}),"function"==typeof this.opt.onload&&this.opt.onload(this)):this.log("No id for DOM"))}},{key:"send",value:function(t,e){this.opt.use_websocket||this.ajax(this.opt.api,t,e)}},{key:"ajax",value:function(t,e,i){var o=this;"object"!=(void 0===e?"undefined":_typeof(e))&&(e={data:e}),e.EC_api=t,o.log("Send Ajax:",e),jQuery.ajax({type:"POST",timeout:6e5,url:this.opt.uri,data:e,success:i,error:function(t,e,i){o.msg("与服务器链接失败，请重试 : "+e+"  "+i,!0)}})}},{key:"msg",value:function(t){t?this.echarts.showLoading({text:t}):this.echarts.hideLoading()}},{key:"size",value:function(t,e){t&&(this.opt.width=t),e&&(this.opt.height=e),this.opt.width&&this.DOM.css({width:this.opt.width}),this.opt.height&&this.DOM.css({height:this.opt.height}),this.resize()}},{key:"resize",value:function(){this.echarts&&this.echarts.resize()}},{key:"load",value:function(t,e){this.echarts?e&&this.init(e):this.init(e);var i=this,o=t||this.opt.post||"";this.send(o,function(t){if(i.log("Recive(raw):",t),"string"==typeof t&&(t=JSON.parse(t)),i.log("Recive(obj):",t),t.result){var e={};t.data&&(e=new Function("EasyChart",t.data)(i)),i.log("option by recive",e),i.opt.debug&&(window.EC_Debug_opt=e,window.EC_Debug_chart=i.echarts),i.echarts.setOption(e),i.echarts.hideLoading()}else{t.msg||t.data;console.log(t);var o=t.msg||t.data||t.message||"";i.msg(o)}})}},{key:"log",value:function(t,e){this.opt.debug&&console.log("EasyChart "+t,e)}}]),t}();jQuery(function(t){t("[EasyChart]").each(function(e){var i={},o=t(this).data("opt");o&&(i="object"==(void 0===o?"undefined":_typeof(o))?o:JSON.parse(o));var a=t(this).attr("id");a||(a=i.id||EC_ID("EasyChart"),t(this).attr("id",a)),i.id=a;var n=t(this).data("api");n&&(i.api=n),t(this).data("debug")&&(i.debug=!0);var s=t(this).data("onload");s&&"function"==typeof window[s]&&(i.onload=window[s]),window.EasyChart_delaytime=1;var h=parseInt(t(this).data("delay"));h||(i.delay?h=i.delay:(h=window.EasyChart_delaytime,window.EasyChart_delaytime+=300));var r=t(this).data("post");r&&(i.post="object"==(void 0===r?"undefined":_typeof(r))?r:JSON.parse(r));var u=window.EC.add(i);t(this).data("EasyChart",u),window.setTimeout(function(){u.load()},h)})});